<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Course Files</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h1 id="courseName"></h1>
  <input type="text" id="fileSearch" placeholder="Search files">
  <div id="fileList"></div>
  <a href="index.html" class="btn">Back to Courses</a>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const courseName = params.get('course');
document.getElementById('courseName').innerText = courseName;

let files = [];

// Helper to embed YouTube
function youtubeEmbed(url){
    if(!url.includes("youtube.com")) return url;
    const videoId = new URL(url).searchParams.get("v");
    return `https://www.youtube.com/embed/${videoId}`;
}

function displayFiles(fileArray){
    const list = document.getElementById('fileList');
    list.innerHTML = '';

    if(fileArray.length === 0){
        list.innerHTML = '<p>No files available</p>';
        return;
    }

    fileArray.forEach(f => {
        const lowerURL = f.url.toLowerCase();
        const div = document.createElement('div');

        // PDF files
        if(lowerURL.endsWith(".pdf")){
            div.classList.add('pdf-file');
            div.innerHTML = `<h4>${f.title}</h4><a href="${f.url}" target="_blank">View PDF</a>`;
        }
        // Images
        else if(lowerURL.endsWith(".jpg") || lowerURL.endsWith(".jpeg") || lowerURL.endsWith(".png") || lowerURL.endsWith(".gif")){
            div.innerHTML = `<h4>${f.title}</h4><img src="${f.url}" alt="${f.title}">`;
        }
        // YouTube videos
        else if(lowerURL.includes("youtube.com")){
            div.innerHTML = `<h4>${f.title}</h4><iframe width="100%" height="220" src="${youtubeEmbed(f.url)}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
        }
        // Other links
        else {
            div.innerHTML = `<h4>${f.title}</h4><a href="${f.url}" target="_blank">${f.url}</a>`;
        }

        list.appendChild(div);
    });
}

// Load files from server
async function loadFiles(){
    try {
        const res = await fetch(`http://localhost:3000/files/${encodeURIComponent(courseName)}`);
        files = await res.json();
        displayFiles(files);
    } catch(err){
        console.error(err);
        document.getElementById('fileList').innerHTML = '<p>Error loading files</p>';
    }
}

// Search files dynamically
document.getElementById('fileSearch').addEventListener('keyup',()=>{
    const filter = document.getElementById('fileSearch').value.toLowerCase();
    const filteredFiles = files.filter(f => f.title.toLowerCase().includes(filter));
    displayFiles(filteredFiles);
});

// Initial load
loadFiles();
</script>
</body>
</html>